name: Tests and Code Coverage Front  

on:
  push:
    branches: [ "main" ]  
  pull_request:
    branches: [ "main" ]  

jobs:
  build_frontend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./front 

    strategy:
      matrix:
        node-version: [16.x]

    steps:
      # √âtape 1 : R√©cup√©ration du code source du d√©p√¥t
      - uses: actions/checkout@v3

      # √âtape 2 : Configuration de la version de Node.js sp√©cifi√©e dans le matrix
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v1
        with:
          node-version: ${{ matrix.node-version }}

      # √âtape 3 : Installation des d√©pendances Node.js
      - name: install dependencies
        run: npm install

      # √âtape 4 : Ex√©cution des tests avec g√©n√©ration de la couverture du code
      - name: test coverage
        run: npm run test-coverage

      # √âtape 5 : V√©rifier le rapport de couverture avant de l'envoyer √† SonarCloud
      - name: Check Coverage Report
        run: cat coverage/bobapp/index.html  # V√©rification que le rapport existe

      - name: Commit Karma Code Coverage Report
        run: |
          # Configuration de l'identit√© Git pour le commit
          git config --global user.email "benyahia.zaim@gmail.com"
          git config --global user.name "zcbe"
          
          # Synchronisation avec la branche "main" pour √©viter les conflits
          git fetch
          git checkout main
          git pull origin main
          
          # Forcer l'ajout du rapport de couverture dans le r√©pertoire "coverage/bobapp"
          git add -f coverage/bobapp
          
          # Cr√©ation d'un commit pour le rapport de couverture de code
          git commit -m "Add Karma code coverage report"
          
          # Pouss√©e du commit vers la branche "main" sur le d√©p√¥t
          git push origin main

          
        # Forcer l'ajout du rapport de couverture dans le r√©pertoire "coverage/bobapp"
          git add -f coverage/bobapp
          
        # Cr√©ation d'un commit pour le rapport de couverture de code
          git commit -m "Add Karma code coverage report"
          
          # Pouss√©e du commit vers la branche "main" sur le d√©p√¥t
          git push origin main

      # √âtape 7 : Affiche le statut des tests avec une ic√¥ne en fonction du succ√®s ou de l'√©chec
      - run: echo "üçè Npm run test-coverage's status is ${{ job.status }}."
